<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Hall Ticket — EduTrack</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@300;400;500;600;700&family=Sora:wght@400;600;700;800&display=swap" rel="stylesheet">
  <link href="../assets/css/main.css" rel="stylesheet">
</head>
<body>
  <div class="sidebar-overlay" id="sidebarOverlay"></div>
  <aside class="sidebar" id="sidebar">
    <div class="sidebar-brand">EduTrack</div>
    <nav class="sidebar-nav">
      <a class="nav-link" href="dashboard.html"><i class="bi bi-grid-1x2"></i> Dashboard</a>
      <a class="nav-link" href="attendance-view.html"><i class="bi bi-calendar-check"></i> View Attendance</a>
      <a class="nav-link active" href="hall-ticket.html"><i class="bi bi-upc-scan"></i> Hall Ticket</a>
      <a class="nav-link" href="results-view.html"><i class="bi bi-journal-text"></i> Results</a>
      <a class="nav-link" href="#" id="logoutBtn"><i class="bi bi-box-arrow-left"></i> Logout</a>
    </nav>
  </aside>
  <div class="main-content">
    <h1 class="h3 mb-4">Hall Ticket</h1>
    <div class="mb-3 no-print"><button type="button" class="btn btn-edu btn-print-hide" id="btnPrint">Print</button></div>
    <div id="hallTicketContent" class="card card-glass p-4" style="max-width: 500px;">
      <div class="text-center mb-4">
        <h4 class="mb-0">EduTrack College</h4>
        <p class="text-muted small mb-0">Examination Hall Ticket</p>
      </div>
      <div id="hallTicketBody">Loading…</div>
    </div>
  </div>
  <nav class="bottom-tab-bar no-print"><a class="tab-item" href="dashboard.html"><i class="bi bi-grid-1x2"></i> Home</a><a class="tab-item" href="attendance-view.html"><i class="bi bi-calendar-check"></i> Attendance</a><a class="tab-item active" href="hall-ticket.html"><i class="bi bi-upc-scan"></i> Hall Ticket</a><a class="tab-item" href="results-view.html"><i class="bi bi-journal-text"></i> Results</a><a class="tab-item" href="#" id="logoutBtnMobile"><i class="bi bi-box-arrow-left"></i> Logout</a></nav>
  <div id="toast-container-edu" class="toast-container-edu"></div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="../assets/js/supabase-config.js"></script>
  <script src="../assets/js/utils.js"></script>
  <script src="../assets/js/auth.js"></script>
  <script>
    (function () {
      requireAuth(['student']).then(async function (profile) {
        if (!profile) return;
        document.getElementById('logoutBtn').onclick = document.getElementById('logoutBtnMobile').onclick = function () { EduTrackAuth.logout(); };
        var seats = (await supabaseClient.from('exam_seats').select('*').eq('student_id', profile.id).order('exam_date', { ascending: false })).data || [];
        var container = document.getElementById('hallTicketBody');
        if (!seats.length) {
          container.innerHTML = '<p class="text-muted">No hall ticket assigned yet.</p>';
          return;
        }
        var s = seats[0];
        var html = '<table class="table table-edu table-borderless"><tr><td class="text-muted">Name</td><td>' + (profile.name || '') + '</td></tr><tr><td class="text-muted">Roll No</td><td>' + (profile.roll_number || '') + '</td></tr><tr><td class="text-muted">Department</td><td>' + (profile.department || '') + '</td></tr><tr><td class="text-muted">Exam</td><td>' + (s.exam_name || '') + '</td></tr><tr><td class="text-muted">Exam Date</td><td>' + formatDate(s.exam_date) + '</td></tr><tr><td class="text-muted">Room</td><td>' + (s.room_number || '') + '</td></tr><tr><td class="text-muted">Seat</td><td>' + (s.seat_number || '') + '</td></tr><tr><td class="text-muted">Hall Ticket No</td><td>' + (s.hall_ticket_no || '') + '</td></tr></table>';
        html += '<div class="mt-3 d-flex justify-content-center"><div id="qrcode"></div></div>';
        container.innerHTML = html;
        if (window.QRCode && s.hall_ticket_no) {
          try {
            new QRCode(document.getElementById('qrcode'), { text: s.hall_ticket_no, width: 120, height: 120 });
          } catch (e) {}
        }
        document.getElementById('btnPrint').onclick = function () { window.print(); };
      });
    })();
  </script>
</body>
</html>
